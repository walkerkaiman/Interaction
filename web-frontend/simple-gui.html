<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Art Installation - Web GUI</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            background: #2196F3;
            color: white;
            padding: 20px;
            text-align: center;
        }
        .nav {
            background: #f8f9fa;
            padding: 10px 20px;
            border-bottom: 1px solid #dee2e6;
        }
        .nav button {
            margin-right: 10px;
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            background: #007bff;
            color: white;
            cursor: pointer;
        }
        .nav button:hover {
            background: #0056b3;
        }
        .nav button.active {
            background: #28a745;
        }
        .content {
            padding: 20px;
        }
        .section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #dee2e6;
            border-radius: 4px;
        }
        .section h3 {
            margin-top: 0;
            color: #333;
        }
        .module-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
        }
        .module-card {
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            background: #f8f9fa;
            cursor: pointer;
            transition: all 0.2s;
        }
        .module-card:hover {
            background: #e9ecef;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .module-card h4 {
            margin: 0 0 10px 0;
            color: #333;
        }
        .module-card p {
            margin: 5px 0;
            color: #666;
        }
        .wiki-content {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 20px;
            margin-top: 20px;
        }
        .wiki-editor {
            width: 100%;
            min-height: 400px;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            resize: vertical;
        }
        .wiki-toolbar {
            margin-bottom: 15px;
            padding: 10px;
            background: #e9ecef;
            border-radius: 4px;
        }
        .wiki-toolbar button {
            margin-right: 10px;
            padding: 5px 10px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
        }
        .wiki-toolbar .save-btn {
            background: #28a745;
            color: white;
        }
        .wiki-toolbar .cancel-btn {
            background: #dc3545;
            color: white;
        }
        .wiki-toolbar .edit-btn {
            background: #007bff;
            color: white;
        }
        .wiki-breadcrumb {
            margin-bottom: 20px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 4px;
        }
        .wiki-breadcrumb a {
            color: #007bff;
            text-decoration: none;
            margin-right: 10px;
        }
        .wiki-breadcrumb a:hover {
            text-decoration: underline;
        }
        .interaction-block {
            border: 2px solid #007bff;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            background: #f0f8ff;
        }
        .interaction-block h4 {
            margin: 0 0 10px 0;
            color: #007bff;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .form-group input, .form-group select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
        }
        .btn-primary {
            background: #007bff;
            color: white;
        }
        .btn-success {
            background: #28a745;
            color: white;
        }
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        .btn:hover {
            opacity: 0.8;
        }
        .event-log {
            height: 300px;
            overflow-y: auto;
            background: #000;
            color: #0f0;
            padding: 10px;
            font-family: monospace;
            border-radius: 4px;
        }
        .status {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .status.connected {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.disconnected {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .hidden {
            display: none;
        }
        .wiki-template {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 4px;
            padding: 15px;
            margin: 15px 0;
        }
        .wiki-template h5 {
            margin-top: 0;
            color: #856404;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Interactive Art Installation - Web GUI</h1>
            <div id="connection-status" class="status disconnected">
                Disconnected from backend
            </div>
        </div>
        
        <div class="nav">
            <button onclick="showSection('dashboard')" class="active">Wiki Dashboard</button>
            <button onclick="showSection('interactions')">Interactions</button>
            <button onclick="showSection('events')">Events</button>
            <button onclick="showSection('config')">Configuration</button>
        </div>
        
        <div class="content">
            <!-- Dashboard/Wiki Section -->
            <div id="dashboard" class="section">
                <div id="wiki-dashboard">
                    <h3>Module Wiki Dashboard</h3>
                    <p>Click on any module to view its documentation and add installation-specific notes.</p>
                    <div class="module-list" id="dashboard-modules">
                        <p>Loading modules...</p>
                    </div>
                </div>
                
                <div id="wiki-page" class="hidden">
                    <div class="wiki-breadcrumb">
                        <a href="#" onclick="showWikiDashboard()">‚Üê Back to Dashboard</a>
                        <span id="wiki-page-title"></span>
                    </div>
                    
                    <div id="wiki-content" class="wiki-content">
                        <!-- Static documentation content -->
                    </div>
                    
                    <div class="wiki-toolbar">
                        <button class="edit-btn" onclick="editInstallationNotes()">Edit Installation Notes</button>
                        <button class="save-btn hidden" onclick="saveInstallationNotes()">Save Notes</button>
                        <button class="cancel-btn hidden" onclick="cancelInstallationNotes()">Cancel</button>
                    </div>
                    
                    <div id="installation-notes-section" class="wiki-content">
                        <h4>üìù Installation Notes</h4>
                        <div id="installation-notes-display">
                            <p><em>No installation notes yet. Click "Edit Installation Notes" to add specific notes for this installation.</em></p>
                        </div>
                    </div>
                    
                    <textarea id="installation-notes-editor" class="wiki-editor hidden" placeholder="Add installation-specific notes here...&#10;&#10;Examples:&#10;- Specific quirks or behaviors for this installation&#10;- Hardware setup notes&#10;- Network configuration details&#10;- Troubleshooting tips for this specific setup"></textarea>
                </div>
            </div>
            
            <!-- Interactions Section -->
            <div id="interactions" class="section hidden">
                <h3>Interactions</h3>
                <div id="interactions-list">
                    <p>Loading interactions...</p>
                </div>
                <button class="btn btn-primary" onclick="addInteraction()">Add New Interaction</button>
            </div>
            
            <!-- Events Section -->
            <div id="events" class="section hidden">
                <h3>Real-Time Events</h3>
                <div class="event-log" id="event-log">
                    Connecting to WebSocket...
                </div>
                <button class="btn btn-primary" onclick="clearEventLog()">Clear Log</button>
            </div>
            
            <!-- Configuration Section -->
            <div id="config" class="section hidden">
                <h3>Configuration</h3>
                <div class="form-group">
                    <label>Installation Name:</label>
                    <input type="text" id="installation-name" placeholder="Enter installation name">
                </div>
                <button class="btn btn-primary" onclick="saveConfig()">Save Configuration</button>
                <button class="btn btn-success" onclick="loadConfig()">Load Configuration</button>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let modules = [];
        let interactions = [];
        let ws = null;
        let wikiData = {};
        let currentWikiModule = null;
        const API_BASE = 'http://localhost:8000';
        
        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            loadModules();
            loadInteractions();
            connectWebSocket();
            loadConfig();
            loadWikiData();
        });
        
        // Navigation
        function showSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.add('hidden');
            });
            
            // Show selected section
            document.getElementById(sectionId).classList.remove('hidden');
            
            // Update nav buttons
            document.querySelectorAll('.nav button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
        }
        
        // Wiki Functions
        function showWikiPage(moduleName) {
            currentWikiModule = moduleName;
            document.getElementById('wiki-dashboard').classList.add('hidden');
            document.getElementById('wiki-page').classList.remove('hidden');
            document.getElementById('wiki-page-title').textContent = `‚Ä∫ ${moduleName}`;
            
            // Load static documentation content
            const content = getDefaultWikiContent(moduleName);
            document.getElementById('wiki-content').innerHTML = content;
            
            // Load installation notes
            loadInstallationNotes(moduleName);
        }
        
        function showWikiDashboard() {
            document.getElementById('wiki-page').classList.add('hidden');
            document.getElementById('wiki-dashboard').classList.remove('hidden');
            currentWikiModule = null;
        }
        
        function loadInstallationNotes(moduleName) {
            const notes = wikiData[moduleName] || '';
            const notesDisplay = document.getElementById('installation-notes-display');
            if (notes) {
                notesDisplay.innerHTML = notes;
            } else {
                notesDisplay.innerHTML = '<p><em>No installation notes yet. Click "Edit Installation Notes" to add specific notes for this installation.</em></p>';
            }
        }
        
        function editInstallationNotes() {
            const notesDisplay = document.getElementById('installation-notes-display');
            const notesEditor = document.getElementById('installation-notes-editor');
            const currentNotes = notesDisplay.innerHTML;
            notesEditor.value = currentNotes;
            notesDisplay.classList.add('hidden');
            notesEditor.classList.remove('hidden');
            
            // Show save/cancel buttons, hide edit button
            document.querySelector('.edit-btn').classList.add('hidden');
            document.querySelector('.save-btn').classList.remove('hidden');
            document.querySelector('.cancel-btn').classList.remove('hidden');
        }
        
        function saveInstallationNotes() {
            const notesEditor = document.getElementById('installation-notes-editor');
            const notesDisplay = document.getElementById('installation-notes-display');
            const notes = notesEditor.value;
            
            // Save to wiki data
            wikiData[currentWikiModule] = notes;
            saveWikiData();
            
            // Update display
            notesDisplay.innerHTML = notes;
            notesDisplay.classList.remove('hidden');
            notesEditor.classList.add('hidden');
            
            // Show edit button, hide save/cancel buttons
            document.querySelector('.edit-btn').classList.remove('hidden');
            document.querySelector('.save-btn').classList.add('hidden');
            document.querySelector('.cancel-btn').classList.add('hidden');
            
            addEventLog(`Installation notes saved for ${currentWikiModule}`);
        }
        
        function cancelInstallationNotes() {
            const notesEditor = document.getElementById('installation-notes-editor');
            const notesDisplay = document.getElementById('installation-notes-display');
            
            notesDisplay.classList.remove('hidden');
            notesEditor.classList.add('hidden');
            
            // Show edit button, hide save/cancel buttons
            document.querySelector('.edit-btn').classList.remove('hidden');
            document.querySelector('.save-btn').classList.add('hidden');
            document.querySelector('.cancel-btn').classList.add('hidden');
        }
        
        function getDefaultWikiContent(moduleName) {
            // Pre-written wiki content for each module type
            const defaultWikiData = {
                "Audio Output": `
                    <h2>üéµ Audio Output Module</h2>
                    
                    <h3>Overview</h3>
                    <p>The Audio Output module plays WAV files with volume control and waveform visualization. It's perfect for triggering sound effects, background music, or audio feedback in interactive installations.</p>
                    
                    <h3>Setup</h3>
                    <ul>
                        <li><strong>File Path:</strong> Select a WAV file (44.1kHz recommended for best performance)</li>
                        <li><strong>Volume:</strong> Set individual volume (0-100%)</li>
                        <li><strong>Waveform:</strong> Automatic waveform generation for visual feedback</li>
                    </ul>
                    
                    <h3>Usage Examples</h3>
                    <ul>
                        <li><strong>Sound Effects:</strong> Connect to OSC input to play sounds on network messages</li>
                        <li><strong>Button Feedback:</strong> Play confirmation sounds on button presses</li>
                        <li><strong>Background Audio:</strong> Loop ambient sounds for atmosphere</li>
                        <li><strong>Interactive Audio:</strong> Trigger different sounds based on sensor input</li>
                    </ul>
                    
                    <h3>Tips & Tricks</h3>
                    <ul>
                        <li>Use short audio files (1-3 seconds) for responsive triggers</li>
                        <li>Keep volume at 80% to avoid audio clipping</li>
                        <li>Generate waveforms for visual feedback in the GUI</li>
                        <li>Multiple audio modules can play simultaneously</li>
                        <li>Supported formats: WAV files only</li>
                    </ul>
                    
                    <h3>Troubleshooting</h3>
                    <ul>
                        <li><strong>No sound:</strong> Check file path, volume settings, and audio device</li>
                        <li><strong>Clicks/pops:</strong> Ensure audio file is 44.1kHz sample rate</li>
                        <li><strong>Delay:</strong> Use smaller audio files for faster response</li>
                        <li><strong>Volume issues:</strong> Check both individual and system volume</li>
                    </ul>
                `,
                
                "OSC Input": `
                    <h2>üì° OSC Input Module</h2>
                    
                    <h3>Overview</h3>
                    <p>The OSC Input module receives Open Sound Control messages over UDP. It's ideal for connecting to external software, mobile apps, or other interactive systems that can send OSC messages.</p>
                    
                    <h3>Setup</h3>
                    <ul>
                        <li><strong>Port:</strong> UDP port to listen on (default: 8000)</li>
                        <li><strong>Address:</strong> OSC address pattern to match (default: "/trigger")</li>
                        <li><strong>Interface:</strong> Listens on all interfaces (0.0.0.0)</li>
                    </ul>
                    
                    <h3>Usage Examples</h3>
                    <ul>
                        <li><strong>TouchOSC:</strong> Connect mobile apps for touch control</li>
                        <li><strong>Max/MSP:</strong> Receive data from Max patches</li>
                        <li><strong>TouchDesigner:</strong> Interface with TD projects</li>
                        <li><strong>Custom Apps:</strong> Build custom controllers</li>
                        <li><strong>Multiple Clients:</strong> Share same port with different addresses</li>
                    </ul>
                    
                    <h3>OSC Message Format</h3>
                    <p>Messages are converted to events with this structure:</p>
                    <pre>{
  "address": "/trigger",
  "args": [0.75],
  "trigger": 0.75,
  "timestamp": 1234567890.123
}</pre>
                    
                    <h3>Tips & Tricks</h3>
                    <ul>
                        <li>Use unique addresses for different functions</li>
                        <li>Test with simple OSC senders like TouchOSC</li>
                        <li>Multiple modules can share the same port</li>
                        <li>Check firewall settings for network access</li>
                    </ul>
                    
                    <h3>Troubleshooting</h3>
                    <ul>
                        <li><strong>No messages:</strong> Check port, firewall, and network settings</li>
                        <li><strong>Wrong address:</strong> Verify OSC address pattern matches</li>
                        <li><strong>Port conflicts:</strong> Ensure port isn't used by other applications</li>
                        <li><strong>Network issues:</strong> Test with localhost first</li>
                    </ul>
                `,
                
                "OSC Output Trigger": `
                    <h2>üì§ OSC Output Trigger Module</h2>
                    
                    <h3>Overview</h3>
                    <p>The OSC Output Trigger module sends OSC messages when triggered by input events. It's perfect for controlling external software, lighting systems, or other OSC-compatible devices.</p>
                    
                    <h3>Setup</h3>
                    <ul>
                        <li><strong>IP Address:</strong> Target device IP (default: 127.0.0.1)</li>
                        <li><strong>Port:</strong> Target UDP port (default: 9001)</li>
                        <li><strong>OSC Address:</strong> Message address (default: "/play")</li>
                    </ul>
                    
                    <h3>Usage Examples</h3>
                    <ul>
                        <li><strong>Lighting Control:</strong> Send triggers to lighting software</li>
                        <li><strong>Video Playback:</strong> Control video players</li>
                        <li><strong>Sound Systems:</strong> Trigger external audio software</li>
                        <li><strong>Robotics:</strong> Send commands to robotic systems</li>
                        <li><strong>Multi-device:</strong> Control multiple OSC devices</li>
                    </ul>
                    
                    <h3>Trigger Behavior</h3>
                    <p>When triggered, this module sends a value of <strong>1</strong> to the specified OSC address. This is ideal for simple on/off triggers.</p>
                    
                    <h3>Tips & Tricks</h3>
                    <ul>
                        <li>Use descriptive OSC addresses for clarity</li>
                        <li>Test connection with OSC monitoring tools</li>
                        <li>Set appropriate target ports for your devices</li>
                        <li>Consider network latency for real-time applications</li>
                    </ul>
                    
                    <h3>Troubleshooting</h3>
                    <ul>
                        <li><strong>No connection:</strong> Check IP address and port</li>
                        <li><strong>Messages not received:</strong> Verify target device is listening</li>
                        <li><strong>Network issues:</strong> Test with localhost first</li>
                        <li><strong>Firewall blocking:</strong> Check network security settings</li>
                    </ul>
                `,
                
                "OSC Output Streaming": `
                    <h2>üì§ OSC Output Streaming Module</h2>
                    
                    <h3>Overview</h3>
                    <p>The OSC Output Streaming module sends OSC messages with dynamic values from input events. Unlike the trigger version, this module forwards the actual data values, making it perfect for continuous data streams.</p>
                    
                    <h3>Setup</h3>
                    <ul>
                        <li><strong>IP Address:</strong> Target device IP (default: 127.0.0.1)</li>
                        <li><strong>Port:</strong> Target UDP port (default: 9001)</li>
                        <li><strong>OSC Address:</strong> Message address (default: "/play")</li>
                    </ul>
                    
                    <h3>Usage Examples</h3>
                    <ul>
                        <li><strong>Sensor Data:</strong> Stream sensor values to visualization software</li>
                        <li><strong>Motion Tracking:</strong> Send position data to 3D software</li>
                        <li><strong>Audio Analysis:</strong> Forward audio levels to lighting systems</li>
                        <li><strong>Interactive Parameters:</strong> Control real-time parameters</li>
                        <li><strong>Data Logging:</strong> Send data to recording systems</li>
                    </ul>
                    
                    <h3>Data Types Supported</h3>
                    <ul>
                        <li><strong>Numbers:</strong> Integers and floats are sent as-is</li>
                        <li><strong>Strings:</strong> Text data is forwarded</li>
                        <li><strong>Auto-detection:</strong> Module automatically detects data type</li>
                    </ul>
                    
                    <h3>Tips & Tricks</h3>
                    <ul>
                        <li>Use appropriate OSC addresses for data types</li>
                        <li>Monitor network bandwidth for high-frequency data</li>
                        <li>Consider data rate limitations of target devices</li>
                        <li>Test with OSC monitoring tools</li>
                    </ul>
                    
                    <h3>Troubleshooting</h3>
                    <ul>
                        <li><strong>Data not received:</strong> Check target device compatibility</li>
                        <li><strong>Wrong data type:</strong> Verify input data format</li>
                        <li><strong>Performance issues:</strong> Reduce data frequency if needed</li>
                        <li><strong>Network congestion:</strong> Monitor network usage</li>
                    </ul>
                `,
                
                "DMX Output Streaming": `
                    <h2>üí° DMX Output Streaming Module</h2>
                    
                    <h3>Overview</h3>
                    <p>The DMX Output Streaming module controls DMX lighting fixtures and devices through a serial connection. It's perfect for creating dynamic lighting effects in interactive installations.</p>
                    
                    <h3>Setup</h3>
                    <ul>
                        <li><strong>Serial Port:</strong> Select available COM port</li>
                        <li><strong>Protocol:</strong> Choose sACN or Art-Net for network DMX</li>
                        <li><strong>Universe:</strong> DMX universe number (1-64000)</li>
                        <li><strong>Channel:</strong> DMX channel to control (1-512)</li>
                    </ul>
                    
                    <h3>Usage Examples</h3>
                    <ul>
                        <li><strong>Stage Lighting:</strong> Control theatrical lighting systems</li>
                        <li><strong>Interactive Displays:</strong> Create responsive lighting effects</li>
                        <li><strong>Architectural Lighting:</strong> Control building lighting</li>
                        <li><strong>Art Installations:</strong> Create dynamic lighting art</li>
                        <li><strong>Event Lighting:</strong> Synchronize lighting with events</li>
                    </ul>
                    
                    <h3>DMX Protocols</h3>
                    <ul>
                        <li><strong>sACN:</strong> Streaming ACN for network DMX</li>
                        <li><strong>Art-Net:</strong> Popular network DMX protocol</li>
                        <li><strong>Serial DMX:</strong> Direct serial connection</li>
                    </ul>
                    
                    <h3>Tips & Tricks</h3>
                    <ul>
                        <li>Use appropriate DMX addresses for your fixtures</li>
                        <li>Test with DMX monitoring software</li>
                        <li>Consider DMX refresh rates for smooth control</li>
                        <li>Plan channel assignments carefully</li>
                    </ul>
                    
                    <h3>Troubleshooting</h3>
                    <ul>
                        <li><strong>No DMX output:</strong> Check serial port and connections</li>
                        <li><strong>Wrong channels:</strong> Verify DMX addressing</li>
                        <li><strong>Network issues:</strong> Check network settings for sACN/Art-Net</li>
                        <li><strong>Fixture not responding:</strong> Verify DMX address and protocol</li>
                    </ul>
                `,
                
                "Serial Input Trigger": `
                    <h2>üîå Serial Input Trigger Module</h2>
                    
                    <h3>Overview</h3>
                    <p>The Serial Input Trigger module reads data from serial devices (Arduino, sensors, etc.) and converts it to trigger events. It's perfect for connecting physical sensors and devices to your interactive installation.</p>
                    
                    <h3>Setup</h3>
                    <ul>
                        <li><strong>Serial Port:</strong> Select available COM port</li>
                        <li><strong>Baud Rate:</strong> Match device baud rate (common: 9600, 115200)</li>
                        <li><strong>Logic Operator:</strong> Choose trigger condition</li>
                        <li><strong>Threshold Value:</strong> Set trigger threshold</li>
                    </ul>
                    
                    <h3>Usage Examples</h3>
                    <ul>
                        <li><strong>Arduino Sensors:</strong> Connect motion, light, or touch sensors</li>
                        <li><strong>Button Interfaces:</strong> Physical button controls</li>
                        <li><strong>Environmental Sensors:</strong> Temperature, humidity, pressure</li>
                        <li><strong>Custom Hardware:</strong> DIY interactive devices</li>
                        <li><strong>Industrial Sensors:</strong> Connect to existing systems</li>
                    </ul>
                    
                    <h3>Trigger Logic</h3>
                    <ul>
                        <li><strong>Greater Than:</strong> Trigger when value > threshold</li>
                        <li><strong>Less Than:</strong> Trigger when value < threshold</li>
                        <li><strong>Equals:</strong> Trigger when value = threshold</li>
                        <li><strong>Not Equals:</strong> Trigger when value ‚â† threshold</li>
                    </ul>
                    
                    <h3>Tips & Tricks</h3>
                    <ul>
                        <li>Use appropriate baud rates for your device</li>
                        <li>Test serial communication with terminal software</li>
                        <li>Consider data format (ASCII vs binary)</li>
                        <li>Use proper voltage levels (3.3V or 5V)</li>
                    </ul>
                    
                    <h3>Troubleshooting</h3>
                    <ul>
                        <li><strong>No data received:</strong> Check port, baud rate, and connections</li>
                        <li><strong>Wrong data format:</strong> Verify data format from device</li>
                        <li><strong>Port not available:</strong> Check if device is connected</li>
                        <li><strong>Trigger not working:</strong> Verify logic and threshold settings</li>
                    </ul>
                `,
                
                "Serial Input Streaming": `
                    <h2>üîå Serial Input Streaming Module</h2>
                    
                    <h3>Overview</h3>
                    <p>The Serial Input Streaming module continuously reads data from serial devices and forwards it as streaming events. Unlike the trigger version, this module provides continuous data flow for real-time applications.</p>
                    
                    <h3>Setup</h3>
                    <ul>
                        <li><strong>Serial Port:</strong> Select available COM port</li>
                        <li><strong>Baud Rate:</strong> Match device baud rate (common: 9600, 115200)</li>
                        <li><strong>Data Format:</strong> Configure data parsing</li>
                    </ul>
                    
                    <h3>Usage Examples</h3>
                    <ul>
                        <li><strong>Real-time Sensors:</strong> Continuous environmental monitoring</li>
                        <li><strong>Motion Tracking:</strong> Real-time position data</li>
                        <li><strong>Audio Analysis:</strong> Continuous audio level monitoring</li>
                        <li><strong>Data Logging:</strong> Continuous data collection</li>
                        <li><strong>Interactive Parameters:</strong> Real-time parameter control</li>
                    </ul>
                    
                    <h3>Data Streaming</h3>
                    <p>This module provides continuous data flow, making it ideal for:</p>
                    <ul>
                        <li>Real-time visualizations</li>
                        <li>Continuous parameter control</li>
                        <li>Data analysis and processing</li>
                        <li>Interactive feedback systems</li>
                    </ul>
                    
                    <h3>Tips & Tricks</h3>
                    <ul>
                        <li>Monitor data rate to avoid overwhelming the system</li>
                        <li>Use appropriate data parsing for your format</li>
                        <li>Consider buffering for high-frequency data</li>
                        <li>Test with simple data formats first</li>
                    </ul>
                    
                    <h3>Troubleshooting</h3>
                    <ul>
                        <li><strong>Data overflow:</strong> Reduce data frequency or increase buffering</li>
                        <li><strong>Parsing errors:</strong> Check data format and parsing settings</li>
                        <li><strong>Performance issues:</strong> Optimize data processing</li>
                        <li><strong>Connection drops:</strong> Check serial connection stability</li>
                    </ul>
                `,
                
                "Time Input Trigger": `
                    <h2>‚è∞ Time Input Trigger Module</h2>
                    
                    <h3>Overview</h3>
                    <p>The Time Input Trigger module generates events based on time intervals and schedules. It's perfect for creating timed sequences, scheduled events, and automated triggers in interactive installations.</p>
                    
                    <h3>Setup</h3>
                    <ul>
                        <li><strong>Target Time:</strong> Set specific time for triggers</li>
                        <li><strong>Interval:</strong> Time between triggers (in seconds)</li>
                        <li><strong>Schedule:</strong> Configure daily/weekly schedules</li>
                    </ul>
                    
                    <h3>Usage Examples</h3>
                    <ul>
                        <li><strong>Timed Sequences:</strong> Automated light shows</li>
                        <li><strong>Scheduled Events:</strong> Daily opening/closing sequences</li>
                        <li><strong>Performance Timing:</strong> Synchronized multi-media events</li>
                        <li><strong>Maintenance Reminders:</strong> Regular system checks</li>
                        <li><strong>Interactive Timing:</strong> Time-based game mechanics</li>
                    </ul>
                    
                    <h3>Time Formats</h3>
                    <ul>
                        <li><strong>Absolute Time:</strong> Specific times (e.g., "14:30")</li>
                        <li><strong>Relative Time:</strong> Intervals from start (e.g., "30s")</li>
                        <li><strong>Cyclic Time:</strong> Repeating patterns</li>
                    </ul>
                    
                    <h3>Tips & Tricks</h3>
                    <ul>
                        <li>Use descriptive time labels for clarity</li>
                        <li>Test timing with shorter intervals first</li>
                        <li>Consider timezone settings for installations</li>
                        <li>Plan for daylight saving time changes</li>
                    </ul>
                    
                    <h3>Troubleshooting</h3>
                    <ul>
                        <li><strong>Wrong timing:</strong> Check system clock and timezone</li>
                        <li><strong>Missed triggers:</strong> Verify system is running</li>
                        <li><strong>Time format errors:</strong> Check time format syntax</li>
                        <li><strong>Schedule issues:</strong> Verify schedule configuration</li>
                    </ul>
                `,
                
                "Frames Input Trigger": `
                    <h2>üé¨ Frames Input Trigger Module</h2>
                    
                    <h3>Overview</h3>
                    <p>The Frames Input Trigger module receives sACN (Streaming ACN) frame data and converts it to trigger events. It's perfect for integrating with professional lighting and video systems that use sACN protocol.</p>
                    
                    <h3>Setup</h3>
                    <ul>
                        <li><strong>IP Address:</strong> Network interface to listen on</li>
                        <li><strong>Universe:</strong> sACN universe number (1-64000)</li>
                        <li><strong>Channel:</strong> DMX channel to monitor (1-512)</li>
                        <li><strong>Threshold:</strong> Trigger threshold value</li>
                    </ul>
                    
                    <h3>Usage Examples</h3>
                    <ul>
                        <li><strong>Lighting Integration:</strong> Connect to professional lighting consoles</li>
                        <li><strong>Video Synchronization:</strong> Sync with video playback systems</li>
                        <li><strong>Multi-venue Shows:</strong> Coordinate across multiple locations</li>
                        <li><strong>Broadcast Integration:</strong> TV and broadcast applications</li>
                        <li><strong>Theater Systems:</strong> Professional theater lighting</li>
                    </ul>
                    
                    <h3>sACN Protocol</h3>
                    <p>sACN (Streaming ACN) is a network protocol for transmitting DMX512 data over Ethernet networks. It's widely used in professional entertainment and architectural lighting.</p>
                    
                    <h3>Tips & Tricks</h3>
                    <ul>
                        <li>Use appropriate network settings for your installation</li>
                        <li>Test with sACN monitoring software</li>
                        <li>Consider network bandwidth for multiple universes</li>
                        <li>Plan universe assignments carefully</li>
                    </ul>
                    
                    <h3>Troubleshooting</h3>
                    <ul>
                        <li><strong>No frames received:</strong> Check network settings and universe</li>
                        <li><strong>Wrong channel data:</strong> Verify channel addressing</li>
                        <li><strong>Network issues:</strong> Check network configuration</li>
                        <li><strong>Protocol errors:</strong> Verify sACN compatibility</li>
                    </ul>
                `,
                
                "Frames Input Streaming": `
                    <h2>üé¨ Frames Input Streaming Module</h2>
                    
                    <h3>Overview</h3>
                    <p>The Frames Input Streaming module continuously receives sACN frame data and forwards it as streaming events. It provides real-time access to DMX512 data for continuous control and monitoring.</p>
                    
                    <h3>Setup</h3>
                    <ul>
                        <li><strong>IP Address:</strong> Network interface to listen on</li>
                        <li><strong>Universe:</strong> sACN universe number (1-64000)</li>
                        <li><strong>Channels:</strong> Range of channels to monitor</li>
                    </ul>
                    
                    <h3>Usage Examples</h3>
                    <ul>
                        <li><strong>Real-time Monitoring:</strong> Live DMX data visualization</li>
                        <li><strong>Continuous Control:</strong> Real-time parameter mapping</li>
                        <li><strong>Data Analysis:</strong> Continuous lighting data analysis</li>
                        <li><strong>Multi-channel Control:</strong> Complex lighting sequences</li>
                        <li><strong>Interactive Mapping:</strong> Real-time parameter mapping</li>
                    </ul>
                    
                    <h3>Streaming Data</h3>
                    <p>This module provides continuous DMX512 data flow, enabling:</p>
                    <ul>
                        <li>Real-time visualizations</li>
                        <li>Continuous parameter control</li>
                        <li>Complex lighting sequences</li>
                        <li>Interactive feedback systems</li>
                    </ul>
                    
                    <h3>Tips & Tricks</h3>
                    <ul>
                        <li>Monitor network bandwidth for multiple universes</li>
                        <li>Use appropriate channel ranges for your needs</li>
                        <li>Consider data processing for high-frequency updates</li>
                        <li>Test with sACN monitoring tools</li>
                    </ul>
                    
                    <h3>Troubleshooting</h3>
                    <ul>
                        <li><strong>Data overflow:</strong> Reduce channel range or optimize processing</li>
                        <li><strong>Network congestion:</strong> Monitor network usage</li>
                        <li><strong>Channel errors:</strong> Verify channel addressing</li>
                        <li><strong>Performance issues:</strong> Optimize data processing</li>
                    </ul>
                `
            };
            
            return defaultWikiData[moduleName] || `
                <div class="wiki-template">
                    <h5>üìù Module Documentation Template</h5>
                    <p>Use this template to document how to use <strong>${moduleName}</strong> in interactive installations:</p>
                    <ul>
                        <li><strong>Overview:</strong> What this module does</li>
                        <li><strong>Setup:</strong> How to configure and install</li>
                        <li><strong>Usage Examples:</strong> Common use cases</li>
                        <li><strong>Tips & Tricks:</strong> Best practices</li>
                        <li><strong>Troubleshooting:</strong> Common issues and solutions</li>
                    </ul>
                    <p>Click "Edit" to start documenting this module!</p>
                </div>
            `;
        }
        
        function loadWikiData() {
            const saved = localStorage.getItem('moduleWikiData');
            if (saved) {
                wikiData = JSON.parse(saved);
            }
        }
        
        function saveWikiData() {
            localStorage.setItem('moduleWikiData', JSON.stringify(wikiData));
        }
        
        // API Functions
        async function loadModules() {
            try {
                const response = await fetch(`${API_BASE}/modules`);
                modules = await response.json();
                displayModules();
                updateConnectionStatus(true);
            } catch (error) {
                console.error('Failed to load modules:', error);
                updateConnectionStatus(false);
            }
        }
        
        async function loadInteractions() {
            try {
                const response = await fetch(`${API_BASE}/config`);
                const config = await response.json();
                interactions = config.interactions || [];
                displayInteractions();
            } catch (error) {
                console.error('Failed to load interactions:', error);
            }
        }
        
        async function loadConfig() {
            try {
                const response = await fetch(`${API_BASE}/config`);
                const config = await response.json();
                document.getElementById('installation-name').value = config.installation_name || '';
            } catch (error) {
                console.error('Failed to load config:', error);
            }
        }
        
        async function saveConfig() {
            try {
                const config = {
                    installation_name: document.getElementById('installation-name').value,
                    interactions: interactions
                };
                
                const response = await fetch(`${API_BASE}/config`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(config)
                });
                
                if (response.ok) {
                    addEventLog('Configuration saved successfully');
                } else {
                    addEventLog('Failed to save configuration');
                }
            } catch (error) {
                console.error('Failed to save config:', error);
                addEventLog('Error saving configuration');
            }
        }
        
        // Display Functions
        function displayModules() {
            const dashboardModules = document.getElementById('dashboard-modules');
            
            // Convert modules object to array and create HTML
            const modulesArray = Object.values(modules);
            const modulesHtml = modulesArray.map(module => `
                <div class="module-card" onclick="showWikiPage('${module.name}')">
                    <h4>${module.name || 'Unknown'}</h4>
                    <p><strong>Type:</strong> ${module.type || 'Unknown'}</p>
                    <p><strong>Classification:</strong> ${module.classification || 'Unknown'}</p>
                    <p><strong>Description:</strong> ${module.description || 'No description'}</p>
                    <p><em>Click to view documentation and add installation notes</em></p>
                </div>
            `).join('');
            
            dashboardModules.innerHTML = modulesHtml;
        }
        
        function displayInteractions() {
            const interactionsList = document.getElementById('interactions-list');
            
            if (interactions.length === 0) {
                interactionsList.innerHTML = '<p>No interactions configured.</p>';
                return;
            }
            
            const interactionsHtml = interactions.map((interaction, index) => `
                <div class="interaction-block">
                    <h4>Interaction ${index + 1}</h4>
                    <p><strong>Input:</strong> ${interaction.input?.module || 'None'}</p>
                    <p><strong>Output:</strong> ${interaction.output?.module || 'None'}</p>
                    <button class="btn btn-danger" onclick="removeInteraction(${index})">Remove</button>
                </div>
            `).join('');
            
            interactionsList.innerHTML = interactionsHtml;
        }
        
        // WebSocket Functions
        function connectWebSocket() {
            try {
                ws = new WebSocket(`ws://localhost:8000/ws/events`);
                
                ws.onopen = function() {
                    addEventLog('WebSocket connected');
                    updateConnectionStatus(true);
                };
                
                ws.onmessage = function(event) {
                    addEventLog(`Event: ${event.data}`);
                };
                
                ws.onclose = function() {
                    addEventLog('WebSocket disconnected');
                    updateConnectionStatus(false);
                    // Try to reconnect after 5 seconds
                    setTimeout(connectWebSocket, 5000);
                };
                
                ws.onerror = function(error) {
                    addEventLog('WebSocket error');
                    updateConnectionStatus(false);
                };
            } catch (error) {
                console.error('Failed to connect WebSocket:', error);
                updateConnectionStatus(false);
            }
        }
        
        function addEventLog(message) {
            const eventLog = document.getElementById('event-log');
            const timestamp = new Date().toLocaleTimeString();
            eventLog.innerHTML += `[${timestamp}] ${message}\n`;
            eventLog.scrollTop = eventLog.scrollHeight;
        }
        
        function clearEventLog() {
            document.getElementById('event-log').innerHTML = '';
        }
        
        function updateConnectionStatus(connected) {
            const status = document.getElementById('connection-status');
            if (connected) {
                status.textContent = 'Connected to backend';
                status.className = 'status connected';
            } else {
                status.textContent = 'Disconnected from backend';
                status.className = 'status disconnected';
            }
        }
        
        // Interaction Functions
        function addInteraction() {
            // Simple interaction creation - you can expand this
            const newInteraction = {
                input: { module: 'osc_input_trigger', config: {} },
                output: { module: 'audio_output_trigger', config: {} }
            };
            
            interactions.push(newInteraction);
            displayInteractions();
            addEventLog('New interaction added');
        }
        
        function removeInteraction(index) {
            interactions.splice(index, 1);
            displayInteractions();
            addEventLog(`Interaction ${index + 1} removed`);
        }

        // Wiki Installation Notes Functions
        function editInstallationNotes() {
            const notesDisplay = document.getElementById('installation-notes-display');
            const notesEditor = document.getElementById('installation-notes-editor');
            const currentNotes = notesDisplay.innerHTML;
            notesEditor.value = currentNotes;
            notesDisplay.classList.add('hidden');
            notesEditor.classList.remove('hidden');
            document.querySelector('.edit-btn').classList.add('hidden');
            document.querySelector('.save-btn').classList.remove('hidden');
            document.querySelector('.cancel-btn').classList.remove('hidden');
        }

        function saveInstallationNotes() {
            const notesEditor = document.getElementById('installation-notes-editor');
            const notesDisplay = document.getElementById('installation-notes-display');
            notesDisplay.innerHTML = notesEditor.value;
            notesDisplay.classList.remove('hidden');
            notesEditor.classList.add('hidden');
            document.querySelector('.edit-btn').classList.remove('hidden');
            document.querySelector('.save-btn').classList.add('hidden');
            document.querySelector('.cancel-btn').classList.add('hidden');
            addEventLog('Installation notes saved');
        }

        function cancelInstallationNotes() {
            const notesEditor = document.getElementById('installation-notes-editor');
            const notesDisplay = document.getElementById('installation-notes-display');
            notesDisplay.innerHTML = notesEditor.value; // Revert to last saved state
            notesDisplay.classList.remove('hidden');
            notesEditor.classList.add('hidden');
            document.querySelector('.edit-btn').classList.remove('hidden');
            document.querySelector('.save-btn').classList.add('hidden');
            document.querySelector('.cancel-btn').classList.add('hidden');
        }
    </script>
</body>
</html> 